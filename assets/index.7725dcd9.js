const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}};M();class b{constructor(t,e,n,r=t<<16|e<<8|n){this.isColor=!0,this.red=t,this.green=e,this.blue=n,this.hex=r,this.count=1}distance(t){return(Math.abs(t.red-this.red)+Math.abs(t.green-this.green)+Math.abs(t.blue-this.blue))/(3*255)}getWeight(t,e){return this.count/e*(1-t)+this.getSaturation()*t}getSaturation(){return this._saturation===void 0&&(this._saturation=Math.max(Math.abs(this.red-this.green)/255,Math.abs(this.red-this.blue)/255,Math.abs(this.green-this.blue)/255)),this._saturation}}class d{constructor(){this.count=1,this.children={}}addGroup(t){return this.children[t]?this.children[t].count++:this.children[t]=new d,this.children[t]}addColor(t,e,n,r){return this.children[t]?this.children[t].count++:this.children[t]=new b(e,n,r,t),this.children[t]}getList(){return Object.keys(this.children).map(t=>this.children[t])}getMaxWeight(t,e){if(this.maxWeight===void 0){const n=this.getList().map(r=>r.isColor?r.getWeight(t,e):r.getMaxWeight(t,e));n.sort((r,i)=>i-r),this.maxWeight=n[0]||0}return this.maxWeight}getMaxWeightColor(t,e){const n=this.getList();return n.sort((r,i)=>r.isColor?i.getWeight(t,e)-r.getWeight(t,e):i.getMaxWeight(t,e)-r.getMaxWeight(t,e)),n[0].isColor?n[0]:n[0].getMaxWeightColor(t,e)}getMaxCountColor(){const t=this.getList();return t.sort((e,n)=>e.isColor?n.count-e.count:n.getMaxCountColor()-e.getMaxCountColor()),t[0].isColor?t[0]:t[0].getMaxCountColor()}getColors(t,e,n){const r=this.getList().map(o=>{const{count:a}=o,h=o.getMaxCountColor();return h.count=a,h});r.sort((o,a)=>a.getWeight(e,n)-o.getWeight(e,n));const i=[];return r.forEach(o=>{const a=i.find(h=>h.distance(o)<t);a?a.count+=o.count:i.push(o)}),i}}const C=(s,t,e=0,n=Number.MAX_SAFE_INTEGER)=>{if(!Number.isInteger(t)||t<e||t>n)throw new Error(`${s} is invalid`);return parseInt(t)},u=(s,t,e=0,n=Number.MAX_VALUE)=>{if(Number(t)!==t||t<e||t>n)throw new Error(`${s} is invalid`);return Number(t)},F=(s,t)=>{if(!t||{}.toString.call(t)!=="[object Function]")throw new Error(`${s} is invalid`);return t};class c{constructor({pixels:t=c.pixelsDefault,distance:e=c.distanceDefault,saturationImportance:n=c.saturationImportanceDefault,splitPower:r=c.splitPowerDefault,colorValidator:i=c.colorValidatorDefault}={}){this.pixels=C("pixels",t,1),this.splitPower=u("splitPower",r,2,16),this.distance=u("distance",e,0,1),this.saturationImportance=u("saturationImportance",n,0,1),this.colorValidator=F("colorValidator",i)}process(t){const e=new d,n=this.splitPower;for(let r=0;r<t.length;r+=4){const i=t[r],o=t[r+1],a=t[r+2],h=t[r+3];if(this.colorValidator(i,o,a,h)){const p=i<<16|o<<8|a,x=(i>>4&15)<<2|(o>>4&15)<<1|a>>4&15,w=Math.round(i*(n-1)/255)*(n*n)+Math.round(o*(n-1)/255)*n+Math.round(a*(n-1)/255);e.addGroup(w).addGroup(x).addColor(p,i,o,a)}}return e.getColors(this.distance,this.saturationImportance,this.pixels)}extract(t){return this.process(t).map(e=>({hex:`#${"0".repeat(6-e.hex.toString(16).length)}${e.hex.toString(16)}`,red:e.red,green:e.green,blue:e.blue,area:e.count/this.pixels,saturation:e.getSaturation()}))}}c.pixelsDefault=1e4;c.distanceDefault=.2;c.saturationImportanceDefault=.2;c.splitPowerDefault=10;c.colorValidatorDefault=(s,t,e,n=255)=>n>250;const I=(s,t)=>{const e=s.width*s.height,n=e<t?s.width:Math.round(s.width*Math.sqrt(t/e)),r=e<t?s.height:Math.round(s.height*Math.sqrt(t/e)),i=document.createElement("canvas");i.width=n,i.height=r;const o=i.getContext("2d");return o.drawImage(s,0,0,s.width,s.height,0,0,n,r),o.getImageData(0,0,n,r)},D=(s,t)=>new c(t).extract(s.data),f=(s,t)=>(s.crossOrigin=t&&t.crossOrigin||null,new Promise(e=>{const n=(r,i)=>{const o=new c(i),a=I(r,o.pixels);e(o.extract(a.data))};if(s.complete)n(s,t);else{const r=()=>{s.removeEventListener("load",r),n(s,t)};s.addEventListener("load",r)}})),L=(s,t)=>{const e=new Image;return e.src=s,f(e,t)},P=(s,t)=>s instanceof ImageData?new Promise(e=>{e(D(s,t))}):s instanceof Image?f(s,t):L(s,t),g=["moon","water","sea","colors","sky"],l=[],W=s=>{const t=Math.round(Math.random()*20)+5;return`https://loremflickr.com/320/240/${g[s%g.length]}/?lock=${t}`},m=s=>Array(s).fill().map((t,e)=>W(e));function y(){return{pixels:1e4,distance:.2,saturationImportance:.2,splitPower:10,srcs:m(5),get list(){return this.srcs.map(s=>({src:s,id:s+this.pixels+this.distance+this.saturationImportance+this.splitPower}))},randomFiles(){this.srcs=m(5)},uploadFile(s){this.srcs=[...s.target.files].map(t=>URL.createObjectURL(t))}}}function E(s){return{$template:"#img-block",colors:[],px:"-",time:"-",mounted(){const t=new Image;t.crossOrigin="anonymous",t.src=this.src,t.onload=()=>{this.px=Math.min(s.pixels,t.naturalWidth*t.naturalHeight)};const e=()=>{const n=Date.now();P(this.src,{pixels:s.pixels,distance:s.distance,saturationImportance:s.saturationImportance,splitPower:s.splitPower,crossOrigin:"anonymous"}).then(r=>{this.time=Date.now()-n,this.colors=r}).finally(()=>{l.shift(),l.length>0&&l[0]()})};l.push(e),l.length<2&&l[0]()}}}window.PetiteVue.createApp({ImgBlock:E,Input:y}).mount();
