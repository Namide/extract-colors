!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):(t=t||self,n(t.extractColors={}))}(this,function(t){"use strict";class n{constructor(t,n,e,i=t<<16|n<<8|e){this.isColor=!0,this.red=t,this.green=n,this.blue=e,this.hex=i,this.count=1}distance(t){return(Math.abs(t.red-this.red)+Math.abs(t.green-this.green)+Math.abs(t.blue-this.blue))/765}getWeight(t,n){return this.count/n+this.getSaturation()*t}getSaturation(){return void 0===this.saturation&&(this.saturation=Math.max(Math.abs(this.red-this.green)/255,Math.abs(this.red-this.blue)/255,Math.abs(this.green-this.blue)/255)),this.saturation}}class e{constructor(){this.count=1,this.children={}}addGroup(t){return this.children[t]?this.children[t].count++:this.children[t]=new e,this.children[t]}addColor(t,e,i,o){return this.children[t]?this.children[t].count++:this.children[t]=new n(e,i,o,t),this.children[t]}getList(){return Object.keys(this.children).map(t=>this.children[t])}getMaxWeight(t,n){if(void 0===this.maxWeight){const e=this.getList().map(e=>e.isColor?e.getWeight(t,n):e.getMaxWeight(t,n));e.sort((t,n)=>n-t),this.maxWeight=e[0]||0}return this.maxWeight}getMaxWeightColor(t,n){const e=this.getList();return e.sort((e,i)=>{if(e.isColor)return i.getWeight(t,n)-e.getWeight(t,n);return i.getMaxWeight(t,n)-e.getMaxWeight(t,n)}),e[0].isColor?e[0]:e[0].getMaxWeightColor(t,n)}getMaxCountColor(){const t=this.getList();return t.sort((t,n)=>{if(t.isColor)return n.count-t.count;return n.getMaxCountColor()-t.getMaxCountColor()}),t[0].isColor?t[0]:t[0].getMaxCountColor()}getColors(t,n,e){const i=this.getList().map(t=>{const n=t.count;const e=t.getMaxCountColor();e.count=n;return e});i.sort((t,i)=>i.getWeight(n,e)-t.getWeight(n,e));const o=[];return i.forEach(n=>{const e=o.find(e=>e.distance(n)<t);e?e.count+=n.count:o.push(n)}),o}}const i=(t,n,e=0,i=Number.MAX_SAFE_INTEGER)=>{if(!Number.isInteger(n)||n<e||n>i)throw new Error(t+" is invalid");return parseInt(n)},o=(t,n,e=0,i=Number.MAX_VALUE)=>{if(Number(n)!=n||n<e||n>i)throw new Error(t+" is invalid");return Number(n)},r=(t,n)=>{if(!n||"[object Function]"!=={}.toString.call(n))throw new Error(t+" is invalid");return n};class s{constructor({pixels:pixels=s.pixelsDefault,distance:distance=s.distanceDefault,saturationImportance:saturationImportance=s.saturationImportanceDefault,splitPower:splitPower=s.splitPowerDefault,colorValidator:colorValidator=s.colorValidatorDefault}={}){this.pixels=i("pixels",pixels,1),this.splitPower=o("splitPower",splitPower,2,16),this.distance=o("distance",distance,0,1),this.saturationImportance=o("saturationImportance",saturationImportance,0),this.colorValidator=r("colorValidator",colorValidator)}process(t){const n=new e,i=this.splitPower;for(let e=0;e<t.length;e+=4){const o=t[e],r=t[e+1],s=t[e+2],a=t[e+3];if(this.colorValidator(o,r,s,a)){const t=o<<16|r<<8|s,e=(o>>4&15)<<2|(r>>4&15)<<1|s>>4&15,a=Math.round(o*(i-1)/255)*(i*i)+Math.round(r*(i-1)/255)*i+Math.round(s*(i-1)/255);n.addGroup(a).addGroup(e).addColor(t,o,r,s)}}return n.getColors(this.distance,this.saturationImportance,this.pixels)}extract(t){return this.process(t).map(t=>({hex:"#"+"0".repeat(6-t.hex.toString(16).length)+t.hex.toString(16),red:t.red,green:t.green,blue:t.blue,area:t.count/this.pixels,saturation:t.saturation/255}))}}s.pixelsDefault=1e4,s.distanceDefault=.2,s.saturationImportanceDefault=.2,s.splitPowerDefault=10,s.colorValidatorDefault=((t,n,e,i=255)=>i>250);const a=(t,n)=>{const e=t.width*t.height;const i=e<n?t.width:Math.round(t.width*Math.sqrt(n/e));const o=e<n?t.height:Math.round(t.height*Math.sqrt(n/e));const r=document.createElement("canvas");r.width=i;r.height=o;const s=r.getContext("2d");s.drawImage(t,0,0,t.width,t.height,0,0,i,o);return s.getImageData(0,0,i,o)},c=(t,n)=>{const e=new s(n);return e.extract(t.data)},u=(t,n)=>{t.crossOrigin=n&&n.crossOrigin||null;return new Promise(e=>{const i=(t,n)=>{const i=new s(n);const o=a(t,i.pixels);e(i.extract(o.data))};if(t.complete)i(t,n);else{const e=()=>{t.removeEventListener("load",e);i(t,n)};t.addEventListener("load",e)}})},h=(t,n)=>{const e=new Image;e.src=t;return u(e,n)},l=(t,n)=>{if(t instanceof ImageData)return new Promise(e=>{e(c(t,n))});if(t instanceof Image)return u(t,n);return h(t,n)};t.default=l,t.extractColorsFromImage=u,t.extractColorsFromImageData=c,t.extractColorsFromSrc=h,Object.defineProperty(t,"__esModule",{value:!0})});
